{"ast":null,"code":"var _jsxFileName = \"D:\\\\xampp\\\\htdocs\\\\neo.co.th\\\\nextapp\\\\src\\\\components\\\\header\\\\Search.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// react\nimport React, { useCallback, useEffect, useRef, useState } from 'react'; // third-party\n\nimport classNames from 'classnames';\nimport { useRouter } from 'next/router'; // application\n\nvar Cross20Svg = function Cross20Svg(props) {\n  return __jsx(\"svg\", props, __jsx(\"path\", {\n    d: \"M17.71 17.71a.99.99 0 0 1-1.4 0L10 11.4l-6.31 6.31a.99.99 0 1 1-1.4-1.4L8.6 10 2.29 3.69a.99.99 0 1 1 1.4-1.4L10 8.6l6.31-6.31a.99.99 0 1 1 1.4 1.4L11.4 10l6.31 6.31a.99.99 0 0 1 0 1.4z\"\n  }));\n};\n\nCross20Svg.defaultProps = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"20\",\n  height: \"20\"\n};\n\nvar Search20Svg = function Search20Svg(props) {\n  return __jsx(\"svg\", props, __jsx(\"path\", {\n    d: \"M19.2 17.8s-.2.5-.5.8c-.4.4-.9.6-.9.6s-.9.7-2.8-1.6c-1.1-1.4-2.2-2.8-3.1-3.9-1 .8-2.4 1.3-3.9 1.3-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7c0 1.5-.5 2.9-1.3 4 1.1.8 2.5 2 4 3.1 2.3 1.7 1.5 2.7 1.5 2.7zM8 3C5.2 3 3 5.2 3 8s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5z\"\n  }));\n};\n\nSearch20Svg.defaultProps = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"20\",\n  height: \"20\"\n};\nimport shopApi from '../../api/shop';\nimport Suggestions from './Suggestions';\n\nfunction useCategories() {\n  const {\n    0: categories,\n    1: setCategories\n  } = useState([]);\n  useEffect(() => {\n    let canceled = false;\n\n    const treeToList = (categories, depth = 0) => categories.reduce((result, category) => [...result, _objectSpread({\n      depth\n    }, category), ...treeToList(category.children || [], depth + 1)], []);\n\n    shopApi.getCategories({\n      depth: 1\n    }).then(categories => {\n      if (canceled) {\n        return;\n      }\n\n      setCategories(treeToList(categories));\n    });\n    return () => {\n      canceled = true;\n    };\n  }, [setCategories]);\n  return categories;\n}\n\nfunction Search(props) {\n  const {\n    context,\n    className,\n    inputRef,\n    onClose\n  } = props;\n  const {\n    0: cancelFn,\n    1: setCancelFn\n  } = useState(() => () => {});\n  const {\n    0: suggestionsOpen,\n    1: setSuggestionsOpen\n  } = useState(false);\n  const {\n    0: hasSuggestions,\n    1: setHasSuggestions\n  } = useState(false);\n  const {\n    0: suggestedProducts,\n    1: setSuggestedProducts\n  } = useState([]);\n  const {\n    0: query,\n    1: setQuery\n  } = useState('');\n  const {\n    0: category,\n    1: setCategory\n  } = useState('[all]');\n  const categories = useCategories();\n  const wrapperRef = useRef(null);\n  const router = useRouter();\n  const close = useCallback(() => {\n    if (onClose) {\n      onClose();\n    }\n\n    setSuggestionsOpen(false);\n  }, [onClose]); // Close suggestions when the location has been changed.\n\n  useEffect(() => close(), [close, router.pathname]); // Close suggestions when a click has been made outside component.\n\n  useEffect(() => {\n    const onGlobalClick = event => {\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {\n        close();\n      }\n    };\n\n    document.addEventListener('mousedown', onGlobalClick);\n    return () => document.removeEventListener('mousedown', onGlobalClick);\n  }, [close]); // Cancel previous typing.\n\n  useEffect(() => () => cancelFn(), [cancelFn]);\n\n  const handleFocus = () => {\n    setSuggestionsOpen(true);\n  };\n\n  const handleChangeCategory = event => {\n    setCategory(event.target.value);\n  };\n\n  const handleChangeQuery = event => {\n    let canceled = false;\n    let timer;\n\n    const newCancelFn = () => {\n      canceled = true;\n      clearTimeout(timer);\n    };\n\n    const query = event.target.value;\n    setQuery(query);\n\n    if (query === '') {\n      setHasSuggestions(false);\n    } else {\n      timer = setTimeout(() => {\n        const options = {\n          limit: 5\n        };\n\n        if (category !== '[all]') {\n          options.category = category;\n        }\n\n        shopApi.getSuggestions(query, options).then(products => {\n          if (canceled) {\n            return;\n          }\n\n          setSuggestedProducts(products);\n          setHasSuggestions(products.length > 0);\n          setSuggestionsOpen(true);\n        });\n      }, 100);\n    }\n\n    setCancelFn(() => newCancelFn);\n  };\n\n  const handleBlur = () => {\n    setTimeout(() => {\n      if (!document.activeElement || document.activeElement === document.body) {\n        return;\n      } // Close suggestions if the focus received an external element.\n\n\n      if (wrapperRef.current && !wrapperRef.current.contains(document.activeElement)) {\n        close();\n      }\n    }, 10);\n  }; // Close suggestions when the Escape key has been pressed.\n\n\n  const handleKeyDown = event => {\n    // Escape.\n    if (event.which === 27) {\n      close();\n    }\n  };\n\n  const rootClasses = classNames(`search search--location--${context}`, className, {\n    'search--suggestions-open': suggestionsOpen,\n    'search--has-suggestions': hasSuggestions\n  });\n  const closeButton = context !== 'mobile-header' ? '' : __jsx(\"button\", {\n    className: \"search__button search__button--type--close\",\n    type: \"button\",\n    onClick: close,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 9\n    }\n  }, __jsx(Cross20Svg, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }\n  }));\n  const categoryOptions = categories.map(category => __jsx(\"option\", {\n    key: category.slug,\n    value: category.slug,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 9\n    }\n  }, '\\u00A0'.repeat(4 * category.depth), category.name));\n  return __jsx(\"div\", {\n    className: rootClasses,\n    ref: wrapperRef,\n    onBlur: handleBlur,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"search__body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }\n  }, __jsx(\"form\", {\n    className: \"search__form\",\n    action: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 17\n    }\n  }, context === 'header' && __jsx(\"select\", {\n    className: \"search__categories\",\n    \"aria-label\": \"Category\",\n    value: category,\n    onFocus: close,\n    onChange: handleChangeCategory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 25\n    }\n  }, __jsx(\"option\", {\n    value: \"[all]\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 29\n    }\n  }, \"All Categories\"), categoryOptions), __jsx(\"input\", {\n    ref: inputRef,\n    onChange: handleChangeQuery,\n    onFocus: handleFocus,\n    onKeyDown: handleKeyDown,\n    value: query,\n    className: \"search__input\",\n    name: \"search\",\n    placeholder: \"Search over 10,000 products\",\n    \"aria-label\": \"Site search\",\n    type: \"text\",\n    autoComplete: \"off\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 21\n    }\n  }), __jsx(\"button\", {\n    className: \"search__button search__button--type--submit\",\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 21\n    }\n  }, __jsx(Search20Svg, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 25\n    }\n  })), closeButton, __jsx(\"div\", {\n    className: \"search__border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 21\n    }\n  })), __jsx(Suggestions, {\n    className: \"search__suggestions\",\n    context: context,\n    products: suggestedProducts,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 17\n    }\n  })));\n}\n\nexport default Search;","map":{"version":3,"sources":["D:/xampp/htdocs/neo.co.th/nextapp/src/components/header/Search.tsx"],"names":["React","useCallback","useEffect","useRef","useState","classNames","useRouter","Cross20Svg","Search20Svg","shopApi","Suggestions","useCategories","categories","setCategories","canceled","treeToList","depth","reduce","result","category","children","getCategories","then","Search","props","context","className","inputRef","onClose","cancelFn","setCancelFn","suggestionsOpen","setSuggestionsOpen","hasSuggestions","setHasSuggestions","suggestedProducts","setSuggestedProducts","query","setQuery","setCategory","wrapperRef","router","close","pathname","onGlobalClick","event","current","contains","target","document","addEventListener","removeEventListener","handleFocus","handleChangeCategory","value","handleChangeQuery","timer","newCancelFn","clearTimeout","setTimeout","options","limit","getSuggestions","products","length","handleBlur","activeElement","body","handleKeyDown","which","rootClasses","closeButton","categoryOptions","map","slug","repeat","name"],"mappings":"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","sourcesContent":["// react\nimport React, {\n    ChangeEvent,\n    KeyboardEvent,\n    RefObject,\n    useCallback,\n    useEffect,\n    useRef,\n    useState,\n} from 'react';\n\n// third-party\nimport classNames from 'classnames';\nimport { useRouter } from 'next/router';\n\n// application\nimport Cross20Svg from '../../svg/cross-20.svg';\nimport Search20Svg from '../../svg/search-20.svg';\nimport shopApi, { GetSuggestionsOptions } from '../../api/shop';\nimport Suggestions from './Suggestions';\nimport { ICategory } from '../../interfaces/category';\nimport { IProduct } from '../../interfaces/product';\n\ntype CategoryWithDepth = ICategory & {depth: number};\n\nfunction useCategories() {\n    const [categories, setCategories] = useState<CategoryWithDepth[]>([]);\n\n    useEffect(() => {\n        let canceled = false;\n\n        const treeToList = (categories: ICategory[], depth = 0): CategoryWithDepth[] => (\n            categories.reduce(\n                (result: CategoryWithDepth[], category) => [\n                    ...result,\n                    { depth, ...category },\n                    ...treeToList(category.children || [], depth + 1),\n                ],\n                [],\n            )\n        );\n\n        shopApi.getCategories({ depth: 1 }).then((categories: ICategory[]) => {\n            if (canceled) {\n                return;\n            }\n\n            setCategories(treeToList(categories));\n        });\n\n        return () => {\n            canceled = true;\n        };\n    }, [setCategories]);\n\n    return categories;\n}\n\nexport interface SearchProps {\n    context: 'header' | 'mobile-header' | 'indicator';\n    className?: string;\n    inputRef?: RefObject<HTMLInputElement>;\n    onClose?: () => void;\n}\n\nfunction Search(props: SearchProps) {\n    const {\n        context,\n        className,\n        inputRef,\n        onClose,\n    } = props;\n    const [cancelFn, setCancelFn] = useState(() => () => {});\n    const [suggestionsOpen, setSuggestionsOpen] = useState(false);\n    const [hasSuggestions, setHasSuggestions] = useState(false);\n    const [suggestedProducts, setSuggestedProducts] = useState<IProduct[]>([]);\n    const [query, setQuery] = useState('');\n    const [category, setCategory] = useState('[all]');\n    const categories = useCategories();\n    const wrapperRef = useRef<HTMLDivElement>(null);\n    const router = useRouter();\n    const close = useCallback(() => {\n        if (onClose) {\n            onClose();\n        }\n\n        setSuggestionsOpen(false);\n    }, [onClose]);\n\n    // Close suggestions when the location has been changed.\n    useEffect(() => close(), [close, router.pathname]);\n\n    // Close suggestions when a click has been made outside component.\n    useEffect(() => {\n        const onGlobalClick = (event: MouseEvent) => {\n            if (wrapperRef.current && !wrapperRef.current.contains(event.target as HTMLElement)) {\n                close();\n            }\n        };\n\n        document.addEventListener('mousedown', onGlobalClick);\n\n        return () => document.removeEventListener('mousedown', onGlobalClick);\n    }, [close]);\n\n    // Cancel previous typing.\n    useEffect(() => () => cancelFn(), [cancelFn]);\n\n    const handleFocus = () => {\n        setSuggestionsOpen(true);\n    };\n\n    const handleChangeCategory = (event: ChangeEvent<HTMLSelectElement>) => {\n        setCategory(event.target.value);\n    };\n\n    const handleChangeQuery = (event: ChangeEvent<HTMLInputElement>) => {\n        let canceled = false;\n        let timer: NodeJS.Timeout;\n\n        const newCancelFn = () => {\n            canceled = true;\n            clearTimeout(timer);\n        };\n\n        const query = event.target.value;\n\n        setQuery(query);\n\n        if (query === '') {\n            setHasSuggestions(false);\n        } else {\n            timer = setTimeout(() => {\n                const options: GetSuggestionsOptions = { limit: 5 };\n\n                if (category !== '[all]') {\n                    options.category = category;\n                }\n\n                shopApi.getSuggestions(query, options).then((products) => {\n                    if (canceled) {\n                        return;\n                    }\n\n                    setSuggestedProducts(products);\n                    setHasSuggestions(products.length > 0);\n                    setSuggestionsOpen(true);\n                });\n            }, 100);\n        }\n\n        setCancelFn(() => newCancelFn);\n    };\n\n    const handleBlur = () => {\n        setTimeout(() => {\n            if (!document.activeElement || document.activeElement === document.body) {\n                return;\n            }\n\n            // Close suggestions if the focus received an external element.\n            if (wrapperRef.current && !wrapperRef.current.contains(document.activeElement)) {\n                close();\n            }\n        }, 10);\n    };\n\n    // Close suggestions when the Escape key has been pressed.\n    const handleKeyDown = (event: KeyboardEvent<HTMLInputElement>) => {\n        // Escape.\n        if (event.which === 27) {\n            close();\n        }\n    };\n\n    const rootClasses = classNames(`search search--location--${context}`, className, {\n        'search--suggestions-open': suggestionsOpen,\n        'search--has-suggestions': hasSuggestions,\n    });\n\n    const closeButton = context !== 'mobile-header' ? '' : (\n        <button className=\"search__button search__button--type--close\" type=\"button\" onClick={close}>\n            <Cross20Svg />\n        </button>\n    );\n\n    const categoryOptions = categories.map((category) => (\n        <option key={category.slug} value={category.slug}>\n            {'\\u00A0'.repeat(4 * category.depth)}\n            {category.name}\n        </option>\n    ));\n\n    return (\n        <div className={rootClasses} ref={wrapperRef} onBlur={handleBlur}>\n            <div className=\"search__body\">\n                <form className=\"search__form\" action=\"\">\n                    {context === 'header' && (\n                        <select\n                            className=\"search__categories\"\n                            aria-label=\"Category\"\n                            value={category}\n                            onFocus={close}\n                            onChange={handleChangeCategory}\n                        >\n                            <option value=\"[all]\">All Categories</option>\n                            {categoryOptions}\n                        </select>\n                    )}\n                    <input\n                        ref={inputRef}\n                        onChange={handleChangeQuery}\n                        onFocus={handleFocus}\n                        onKeyDown={handleKeyDown}\n                        value={query}\n                        className=\"search__input\"\n                        name=\"search\"\n                        placeholder=\"Search over 10,000 products\"\n                        aria-label=\"Site search\"\n                        type=\"text\"\n                        autoComplete=\"off\"\n                    />\n                    <button className=\"search__button search__button--type--submit\" type=\"submit\">\n                        <Search20Svg />\n                    </button>\n                    {closeButton}\n                    <div className=\"search__border\" />\n                </form>\n\n                <Suggestions className=\"search__suggestions\" context={context} products={suggestedProducts} />\n            </div>\n        </div>\n    );\n}\n\nexport default Search;\n"]},"metadata":{},"sourceType":"module"}